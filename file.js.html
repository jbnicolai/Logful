<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: handlers/file.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: handlers/file.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Dreamscapes\logful
 *
 * Licensed under the BSD-3-Clause license
 * For full copyright and license information, please see the LICENSE file
 *
 * @author     Robert Rossmann &lt;rr.rossmann@me.com>
 * @copyright  2014 Robert Rossmann
 * @link       https://github.com/Dreamscapes/logful
 * @license    http://choosealicense.com/licenses/BSD-3-Clause  BSD-3-Clause License
 */

'use strict';

/** @private */
var util = require('util')
  , fs = require('fs')
  , merge = require('merge')
  , GenericHandler = require('./generichandler')

module.exports = File

// Extend GenericHandler
util.inherits(File, GenericHandler)

/**
 * The File class logs all incoming messages to, surprisingly, a file
 *
 * @class
 * @extends   {GenericHandler}
 * @param     {Object}  opts           Configuration for the File handler
 * @param     {String}  opts.path      Path to a file where entries should be appended
 * @param     {Object}  opts.fsOpts    Additional configuration object which will be passed directly
 *            to {@link http://nodejs.org/api/fs.html#fs_fs_createwritestream_path_options
 *            |fs.createWriteStream}
 */
function File (opts) {

  // Normalise args
  opts = opts || {}
  opts.fsOpts = opts.fsOpts || {}

  // Parent constructor
  File.super_.call(this, opts)

  // Generate options object for fs
  var fsOpts = merge(
  { flags: 'a'          // Open file for appending and create it if it does not exist
  , encoding: 'utf8'
  }, opts.fsOpts)

  // Allow api injection for testing
  var dest = arguments[1] ? arguments[1] : fs.createWriteStream(opts.path, fsOpts)

  /**
   * Log an entry to File
   *
   * @param   {Logful.Entry}   entry   The information about the entry
   * @return  {File}
   */
  this.log = function log (entry) {

    // Send the processed message to file
    dest.write(this.compileEntry(entry, this.formats.message) + '\n')

    return this
  }
}

/**
 * Default formats File will use when logging entries
 *
 * @type {Object}
 * @readonly
 * @property  {String}  message     Message format
 * @property  {String}  timestamp   Timestamp format
 */
File.prototype.formats =
{ message: '{timestamp}\t{levelName}\t{identity}:\t{message}'
, timestamp: 'YYYY-MM-DD HH:mm:ss.SSS'
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="Console.html">Console</a></li><li><a href="File.html">File</a></li><li><a href="GenericHandler.html">GenericHandler</a></li><li><a href="Logful.html">Logful</a></li><li><a href="Syslog.html">Syslog</a></li></ul><h3>Events</h3><ul><li><a href="Logful.html#event:entry">entry</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha9</a> on Sat Sep 13 2014 18:23:03 GMT+0000 (UTC)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
